import{c as l,b as e,o as i,d as Q,r as _,i as P,s as x,h as G,e as C,j as u,g as Z,k as c,A as j,t as d,B as J,f as g,v,F as f,q as b,w as K,p as S,x as W}from"./index-DShiURXh.js";import{r as X}from"./PlusIcon-3nd0CGQo.js";import{r as Y}from"./ClockIcon-DftcQWUa.js";import{r as ee}from"./CalendarIcon-CvT_5CDG.js";import{r as te}from"./PencilIcon-BUBQsvjv.js";import{r as V}from"./TrashIcon-fFiWIMmY.js";function se(q,m){return i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function oe(q,m){return i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"})])}const re={class:"space-y-6"},le={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},ie={class:"grid grid-cols-1 sm:grid-cols-3 gap-6"},ne={class:"bg-white rounded-2xl shadow-md p-6 border border-gray-100"},ae={class:"flex items-center"},de={class:"h-12 w-12 rounded-xl bg-orange-100 flex items-center justify-center"},ue={class:"ml-4"},ce={class:"text-2xl font-bold text-gray-900"},ge={class:"bg-white rounded-2xl shadow-md p-6 border border-gray-100"},me={class:"flex items-center"},xe={class:"h-12 w-12 rounded-xl bg-blue-100 flex items-center justify-center"},pe={class:"ml-4"},ve={class:"text-2xl font-bold text-gray-900"},fe={class:"bg-white rounded-2xl shadow-md p-6 border border-gray-100"},be={class:"flex items-center"},ye={class:"h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center"},he={class:"ml-4"},we={class:"text-2xl font-bold text-gray-900"},_e={class:"bg-white rounded-2xl shadow-md p-6 border border-gray-100"},Pe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},ke={class:"flex items-center space-x-4"},Ae={class:"flex items-center"},Ce={class:"bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden"},qe={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-white divide-y divide-gray-200"},je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Se={class:"px-6 py-4 text-sm text-gray-900"},Ve={key:0,class:"space-y-1"},$e={class:"font-medium"},Fe={class:"text-gray-500"},Me={key:1,class:"text-gray-400 italic"},Ue={class:"px-6 py-4 text-sm text-gray-900"},Te={key:0,class:"space-y-1"},Le={class:"font-medium"},Ee={class:"text-gray-500"},Be={key:1,class:"text-gray-400 italic"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono"},ze={class:"px-6 py-4 whitespace-nowrap"},Re={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},He={class:"flex items-center space-x-2"},Oe=["onClick"],Qe=["onClick"],Ge=["onClick"],Ze=["onClick"],Je={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ke={class:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"},We={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl"},Xe={class:"flex items-center justify-between"},Ye={class:"flex items-center space-x-3"},et={class:"h-10 w-10 rounded-xl bg-orange-500 flex items-center justify-center"},tt={class:"text-xl font-bold text-gray-900"},st={class:"p-6"},ot={class:"bg-gray-50 rounded-xl p-4"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lt=["value"],it={class:"bg-gray-50 rounded-xl p-4"},nt={key:0,class:"text-center py-8 text-gray-500"},at={key:1,class:"space-y-4"},dt=["onUpdate:modelValue","onChange"],ut=["value"],ct={class:"text-xs text-gray-500 mt-1"},gt=["onUpdate:modelValue"],mt=["onUpdate:modelValue"],xt={class:"flex items-end space-x-2"},pt={class:"flex-1"},vt=["onUpdate:modelValue"],ft=["onClick"],bt={class:"bg-gray-50 rounded-xl p-4"},yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ht={class:"sticky bottom-0 bg-white border-t border-gray-200 px-6 py-4 rounded-b-2xl"},wt={class:"flex flex-col sm:flex-row gap-3 justify-end"},_t={type:"submit",form:"production-form",class:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors"},It=Q({__name:"ProductionView",setup(q){const m=_([]),y=_(!1),p=_(null),k=_(""),h=P(()=>{const o=x.getStock();console.log("Stock complet:",o);const t=o.filter(s=>s.actif);return console.log("Articles actifs:",t),t});G(()=>{w()});const w=()=>{const t=x.getProductions().map(s=>s.articlesProduits&&Array.isArray(s.articlesProduits)?s:(console.log("Migration de la production:",s.id),{...s,articlesProduits:[{articleId:1,quantiteProduite:s.briquesProduites||0,quantitePlanifiee:s.briquesProduites||0,unite:"pièces"}]}));m.value=t},r=_({date:"",articlesProduits:[],statut:"en_attente",lotId:"",heureDebut:"",heureFin:""}),A=[{value:"en_attente",label:"En attente",color:"bg-yellow-100 text-yellow-800"},{value:"en_cours",label:"En cours",color:"bg-blue-100 text-blue-800"},{value:"termine",label:"Terminé",color:"bg-green-100 text-green-800"}],$=P(()=>{const o={};return m.value.forEach(t=>{t.articlesProduits&&Array.isArray(t.articlesProduits)&&t.articlesProduits.forEach(s=>{const n=h.value.find(a=>a.id===s.articleId);if(n){const a=n.typeProduction;o[a]=(o[a]||0)+s.quantiteProduite}})}),o}),F=P(()=>{const o=new Date().toISOString().split("T")[0];return m.value.filter(t=>t.date===o&&t.statut==="termine").reduce((t,s)=>{if(s.articlesProduits&&Array.isArray(s.articlesProduits)){const n=s.articlesProduits.reduce((a,O)=>a+O.quantiteProduite,0);return t+n}return t},0)}),M=P(()=>m.value.filter(o=>o.statut==="en_cours")),U=P(()=>k.value?m.value.filter(o=>o.date===k.value):m.value),D=o=>{o?(p.value=o,r.value={date:o.date,articlesProduits:[...o.articlesProduits],statut:o.statut,lotId:o.lotId,heureDebut:o.heureDebut||"",heureFin:o.heureFin||""}):(p.value=null,r.value={date:new Date().toISOString().split("T")[0],articlesProduits:[],statut:"en_attente",lotId:x.generateLotId(),heureDebut:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),heureFin:""}),y.value=!0},T=()=>{if(r.value.articlesProduits.length===0){alert("Veuillez ajouter au moins un article à produire");return}const o={...r.value,date:r.value.date||new Date().toISOString().split("T")[0]};try{p.value?x.updateProduction(p.value.id,o):x.addProduction(o),w(),y.value=!1,p.value=null}catch(t){alert(`Erreur lors de la sauvegarde: ${t}`)}},L=o=>{confirm("Êtes-vous sûr de vouloir supprimer cette production ?")&&(x.deleteProduction(o),w())},E=o=>{x.updateProduction(o.id,{statut:"en_cours",heureDebut:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}),w()},B=o=>{x.updateProduction(o.id,{statut:"termine",heureFin:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}),w()},I=o=>A.find(t=>t.value===o)||A[0],N=o=>h.value.find(t=>t.id===o),z=()=>{r.value.articlesProduits.push({articleId:0,quantiteProduite:0,quantitePlanifiee:0,unite:""})},R=o=>{r.value.articlesProduits.splice(o,1)},H=o=>{console.log("onArticleChange appelé avec index:",o),console.log("Article sélectionné:",r.value.articlesProduits[o].articleId);const t=h.value.find(s=>s.id===r.value.articlesProduits[o].articleId);console.log("Article trouvé:",t),t&&(r.value.articlesProduits[o].unite=t.unite,r.value.articlesProduits[o].quantitePlanifiee=t.capaciteProduction,r.value.articlesProduits[o].quantiteProduite=0,console.log("Article mis à jour:",r.value.articlesProduits[o]))};return(o,t)=>(i(),l("div",re,[e("div",le,[t[9]||(t[9]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-900"},"Production"),e("p",{class:"mt-2 text-gray-600"},"Gestion de la production d'articles")],-1)),e("button",{onClick:t[0]||(t[0]=s=>D()),class:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-xl transition-colors"},[u(c(X),{class:"h-5 w-5 mr-2"}),t[8]||(t[8]=Z(" Nouvelle production ",-1))])]),e("div",ie,[e("div",ne,[e("div",ae,[e("div",de,[u(c(j),{class:"h-6 w-6 text-orange-600"})]),e("div",ue,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Production aujourd'hui",-1)),e("p",ce,d(F.value.toLocaleString()),1),t[11]||(t[11]=e("p",{class:"text-sm text-gray-500"},"articles",-1))])])]),e("div",ge,[e("div",me,[e("div",xe,[u(c(J),{class:"h-6 w-6 text-blue-600"})]),e("div",pe,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Total briques",-1)),e("p",ve,d($.value.brique||0),1)])])]),e("div",fe,[e("div",be,[e("div",ye,[u(c(Y),{class:"h-6 w-6 text-green-600"})]),e("div",he,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"En cours",-1)),e("p",we,d(M.value.length),1),t[14]||(t[14]=e("p",{class:"text-sm text-gray-500"},"lots",-1))])])])]),e("div",_e,[e("div",Pe,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4 sm:mb-0"},"Production récente",-1)),e("div",ke,[e("div",Ae,[u(c(ee),{class:"h-5 w-5 text-gray-400 mr-2"}),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),type:"date",class:"rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500"},null,512),[[v,k.value]])])])])]),e("div",Ce,[e("div",qe,[e("table",De,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Articles "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Quantités "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Lot ID "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Ie,[(i(!0),l(f,null,b(U.value,s=>(i(),l("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",je,d(new Date(s.date).toLocaleDateString("fr-FR")),1),e("td",Se,[s.articlesProduits&&Array.isArray(s.articlesProduits)?(i(),l("div",Ve,[(i(!0),l(f,null,b(s.articlesProduits,n=>(i(),l("div",{key:n.articleId,class:"flex items-center space-x-2"},[e("span",$e,d(N(n.articleId)?.nom||"Article inconnu"),1),e("span",Fe,"("+d(n.quantiteProduite)+" "+d(n.unite)+")",1)]))),128))])):(i(),l("div",Me," Ancienne structure - à migrer "))]),e("td",Ue,[s.articlesProduits&&Array.isArray(s.articlesProduits)?(i(),l("div",Te,[(i(!0),l(f,null,b(s.articlesProduits,n=>(i(),l("div",{key:n.articleId},[e("span",Le,d(n.quantiteProduite),1),e("span",Ee,"/ "+d(n.quantitePlanifiee)+" "+d(n.unite),1)]))),128))])):(i(),l("div",Be," - "))]),e("td",Ne,d(s.lotId),1),e("td",ze,[e("span",{class:W(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",I(s.statut).color])},d(I(s.statut).label),3)]),e("td",Re,[e("div",He,[s.statut==="en_attente"?(i(),l("button",{key:0,onClick:n=>E(s),class:"text-green-600 hover:text-green-900",title:"Démarrer"},[u(c(se),{class:"h-4 w-4"})],8,Oe)):C("",!0),s.statut==="en_cours"?(i(),l("button",{key:1,onClick:n=>B(s),class:"text-red-600 hover:text-red-900",title:"Arrêter"},[u(c(oe),{class:"h-4 w-4"})],8,Qe)):C("",!0),e("button",{onClick:n=>D(s),class:"text-orange-600 hover:text-orange-900",title:"Modifier"},[u(c(te),{class:"h-4 w-4"})],8,Ge),e("button",{onClick:n=>L(s.id),class:"text-red-600 hover:text-red-900",title:"Supprimer"},[u(c(V),{class:"h-4 w-4"})],8,Ze)])])]))),128))])])])]),y.value?(i(),l("div",Je,[e("div",Ke,[e("div",We,[e("div",Xe,[e("div",Ye,[e("div",et,[u(c(j),{class:"h-5 w-5 text-white"})]),e("div",null,[e("h3",tt,d(p.value?"Modifier la production":"Nouvelle production"),1),t[17]||(t[17]=e("p",{class:"text-sm text-gray-500"},"Gestion des lots de production d'articles",-1))])]),e("button",{onClick:t[2]||(t[2]=s=>y.value=!1),class:"text-gray-400 hover:text-gray-600"},[...t[18]||(t[18]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",st,[e("form",{id:"production-form",onSubmit:K(T,["prevent"]),class:"space-y-6"},[e("div",ot,[t[21]||(t[21]=e("h4",{class:"font-semibold text-gray-900 mb-3"},"Informations de base",-1)),e("div",rt,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date de production",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.date=s),type:"date",required:"",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500 bg-white"},null,512),[[v,r.value.date]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut du lot",-1)),g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.statut=s),required:"",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500 bg-white"},[(i(),l(f,null,b(A,s=>e("option",{key:s.value,value:s.value},d(s.label),9,lt)),64))],512),[[S,r.value.statut]])])])]),e("div",it,[e("div",{class:"flex items-center justify-between mb-4"},[t[22]||(t[22]=e("h4",{class:"font-semibold text-gray-900"},"Articles à produire",-1)),e("button",{type:"button",onClick:z,class:"px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm"}," + Ajouter un article ")]),r.value.articlesProduits.length===0?(i(),l("div",nt,[...t[23]||(t[23]=[e("p",null,"Aucun article ajouté",-1),e("p",{class:"text-sm"},'Cliquez sur "Ajouter un article" pour commencer',-1)])])):(i(),l("div",at,[(i(!0),l(f,null,b(r.value.articlesProduits,(s,n)=>(i(),l("div",{key:n,class:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-white rounded-lg border border-gray-200"},[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Article",-1)),g(e("select",{"onUpdate:modelValue":a=>s.articleId=a,onChange:a=>H(n),required:"",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500"},[t[24]||(t[24]=e("option",{value:""},"Sélectionner un article",-1)),(i(!0),l(f,null,b(h.value,a=>(i(),l("option",{key:a.id,value:a.id},d(a.nom)+" ("+d(a.typeProduction)+") ",9,ut))),128))],40,dt),[[S,s.articleId]]),e("p",ct,d(h.value.length)+" articles disponibles ",1)]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quantité planifiée",-1)),g(e("input",{"onUpdate:modelValue":a=>s.quantitePlanifiee=a,type:"number",required:"",min:"0",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500"},null,8,gt),[[v,s.quantitePlanifiee,void 0,{number:!0}]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quantité produite",-1)),g(e("input",{"onUpdate:modelValue":a=>s.quantiteProduite=a,type:"number",required:"",min:"0",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500"},null,8,mt),[[v,s.quantiteProduite,void 0,{number:!0}]])]),e("div",xt,[e("div",pt,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unité",-1)),g(e("input",{"onUpdate:modelValue":a=>s.unite=a,type:"text",readonly:"",class:"w-full rounded-lg border-gray-300 bg-gray-100"},null,8,vt),[[v,s.unite]])]),e("button",{type:"button",onClick:a=>R(n),class:"px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Supprimer cet article"},[u(c(V),{class:"h-4 w-4"})],8,ft)])]))),128))]))]),e("div",bt,[t[31]||(t[31]=e("h4",{class:"font-semibold text-gray-900 mb-3"},"Horaires de production",-1)),e("div",yt,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Heure de début",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.heureDebut=s),type:"time",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500 bg-white"},null,512),[[v,r.value.heureDebut]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Heure de fin",-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.heureFin=s),type:"time",class:"w-full rounded-lg border-gray-300 focus:border-orange-500 focus:ring-orange-500 bg-white"},null,512),[[v,r.value.heureFin]])])])])],32)]),e("div",ht,[e("div",wt,[e("button",{type:"button",onClick:t[7]||(t[7]=s=>y.value=!1),class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"}," Annuler "),e("button",_t,d(p.value?"Modifier la production":"Créer la production"),1)])])])])):C("",!0)]))}});export{It as default};
