import{c as d,a as e,o as i,d as q,x as A,u as R,r as f,f as k,t as r,n as V,g as v,v as h,w as $,A as N,p as Z,y as z,G as F,j as m,b as p,h as C,F as G,z as H,q as J,i as K,s as Q}from"./index-D0gnmK0b.js";import{r as W,a as X}from"./PlusIcon-Dl4LIrTD.js";import{r as Y}from"./CheckCircleIcon-DIOsNbTF.js";import{r as ee}from"./ShieldCheckIcon-DR0x_S6N.js";import{r as se}from"./TrashIcon-CaummfL_.js";function te(y,w){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])}function P(y,w){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})])}const oe={class:"modal-body"},ae={class:"user-info"},le={class:"user-avatar"},ne={class:"user-details"},re={class:"user-name"},ie={class:"user-email"},de={class:"login-options"},ue={class:"password-section"},ce={class:"modal-actions"},me=["disabled"],pe=q({__name:"AutoLoginModal",props:{show:{type:Boolean},user:{}},emits:["close","success"],setup(y,{emit:w}){const U=y,M=w;A(),R();const _=f(""),u=a=>({superadmin:"Super Admin",admin:"Administrateur",manager:"Manager",operator:"Opérateur",secretaire:"Secrétaire",livreur:"Livreur"})[a]||a,c=()=>{M("close")},g=async()=>{try{console.log("🔐 [AutoLoginModal] Tentative de connexion automatique...");const{loginUser:a}=A(),l=await a(U.user.email,_.value);localStorage.setItem("user",JSON.stringify(l.user)),localStorage.setItem("session",JSON.stringify(l.session)),console.log("✅ [AutoLoginModal] Connexion automatique réussie"),M("success"),c()}catch(a){console.error("❌ [AutoLoginModal] Erreur lors de la connexion automatique:",a),alert("Erreur lors de la connexion automatique")}};return(a,l)=>a.show?(i(),d("div",{key:0,class:"modal-overlay",onClick:c},[e("div",{class:"modal-content",onClick:l[1]||(l[1]=$(()=>{},["stop"]))},[e("div",{class:"modal-header"},[l[3]||(l[3]=e("h2",{class:"modal-title"},"Connexion automatique",-1)),e("button",{onClick:c,class:"modal-close"},[...l[2]||(l[2]=[e("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",oe,[e("div",ae,[e("div",le,r(a.user.first_name.charAt(0))+r(a.user.last_name.charAt(0)),1),e("div",ne,[e("h3",re,r(a.user.first_name)+" "+r(a.user.last_name),1),e("p",ie,r(a.user.email),1),e("span",{class:V(`role-badge role-${a.user.role}`)},r(u(a.user.role)),3)])]),e("div",de,[l[6]||(l[6]=e("p",{class:"login-text"},"Voulez-vous vous connecter automatiquement avec ce compte ?",-1)),e("div",ue,[l[4]||(l[4]=e("label",{class:"form-label"},"Mot de passe temporaire",-1)),v(e("input",{"onUpdate:modelValue":l[0]||(l[0]=n=>_.value=n),type:"password",class:"form-input",placeholder:"Mot de passe temporaire"},null,512),[[h,_.value]]),l[5]||(l[5]=e("p",{class:"password-hint"},"Le mot de passe sera changé lors de la première connexion",-1))])])]),e("div",ce,[e("button",{onClick:c,class:"btn btn-secondary"}," Annuler "),e("button",{onClick:g,class:"btn btn-primary",disabled:!_.value}," Se connecter automatiquement ",8,me)])])])):k("",!0)}}),ve=N(pe,[["__scopeId","data-v-2e94103c"]]),fe={class:"personnel-container"},_e={class:"personnel-header"},ge={class:"header-content"},he={class:"header-main"},we={class:"flex items-center"},be={class:"h-12 w-12 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center mr-4 shadow-lg"},ke={class:"flex items-center space-x-4"},ye={class:"main-content"},Me={class:"stats-grid"},xe={class:"stat-card"},Ce={class:"stat-content"},Ue={class:"stat-icon-wrapper stat-blue"},Ae={class:"stat-details"},Ve={class:"stat-value"},$e={class:"stat-card"},Se={class:"stat-content"},Le={class:"stat-icon-wrapper stat-green"},Pe={class:"stat-details"},qe={class:"stat-value"},Ne={class:"stat-card"},je={class:"stat-content"},Be={class:"stat-icon-wrapper stat-purple"},Ee={class:"stat-details"},Ie={class:"stat-value"},Oe={class:"users-grid"},Te={class:"user-header"},De={class:"user-avatar"},Re={class:"avatar-circle"},Ze={class:"user-info"},ze={class:"user-name"},Fe={class:"user-email"},Ge={class:"user-meta"},He={key:0,class:"user-phone"},Je={class:"user-actions"},Ke=["onClick"],Qe=["onClick"],We={class:"modal-header"},Xe={class:"modal-title"},Ye={class:"form-row"},es={class:"form-group"},ss={class:"form-group"},ts={class:"form-group"},os={key:0,class:"form-group"},as={class:"form-row"},ls={class:"form-group"},ns={class:"form-group"},rs={class:"form-group"},is={class:"checkbox-group"},ds={class:"checkbox-label"},us={class:"modal-actions"},cs={type:"submit",class:"btn btn-primary"},ms=q({__name:"PersonnelView",setup(y){const{getUsers:w,createUser:U,updateUser:M,deleteUser:_}=A(),u=f([]),c=f(!1),g=f(!1),a=f(null),l=f(null),n=f({email:"",first_name:"",last_name:"",role:"operator",phone:"",actif:!0,password:""}),j=Z(()=>u.value.filter(o=>o.actif).length),x=async()=>{try{console.log("🔍 [PersonnelView] Chargement des utilisateurs..."),u.value=await w(),console.log("✅ [PersonnelView] Utilisateurs chargés:",u.value.length)}catch(o){console.error("❌ [PersonnelView] Erreur lors du chargement des utilisateurs:",o)}},S=o=>{o?(a.value=o,n.value={email:o.email,first_name:o.first_name,last_name:o.last_name,role:o.role,phone:o.phone||"",actif:o.actif,password:""}):(a.value=null,n.value={email:"",first_name:"",last_name:"",role:"operator",phone:"",actif:!0,password:""}),c.value=!0},b=()=>{c.value=!1,a.value=null},B=async()=>{try{if(console.log("💾 [PersonnelView] Sauvegarde de l'utilisateur..."),a.value)await M(a.value.id,n.value),console.log("✅ [PersonnelView] Utilisateur mis à jour"),await x(),b(),alert("Utilisateur mis à jour avec succès !");else{const o=await U(n.value);console.log("✅ [PersonnelView] Utilisateur créé"),l.value=o,await x(),b(),g.value=!0}}catch(o){console.error("❌ [PersonnelView] Erreur lors de la sauvegarde:",o),alert("Erreur lors de la sauvegarde de l'utilisateur")}},E=async o=>{if(confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ?"))try{console.log("🗑️ [PersonnelView] Suppression de l'utilisateur:",o),await _(o),await x(),console.log("✅ [PersonnelView] Utilisateur supprimé")}catch(s){console.error("❌ [PersonnelView] Erreur lors de la suppression:",s),alert("Erreur lors de la suppression de l'utilisateur")}},I=o=>({superadmin:"Super Admin",admin:"Administrateur",manager:"Manager",operator:"Opérateur",secretaire:"Secrétaire",livreur:"Livreur"})[o]||o,O=o=>u.value.filter(s=>s.role===o).length,L=()=>{g.value=!1,l.value=null},T=()=>{console.log("✅ [PersonnelView] Connexion automatique réussie"),L(),alert("Connexion automatique réussie !")};return z(()=>{x()}),(o,s)=>(i(),d("div",fe,[e("div",_e,[e("div",ge,[e("div",he,[e("div",we,[e("div",be,[m(p(P),{class:"h-6 w-6 text-white"})]),s[9]||(s[9]=e("div",null,[e("h1",{class:"page-title"},"Gestion du Personnel"),e("p",{class:"page-subtitle"},"Création et gestion des utilisateurs")],-1))]),e("div",ke,[e("button",{onClick:s[0]||(s[0]=t=>S()),class:"action-button"},[m(p(W),{class:"h-5 w-5 mr-2"}),s[10]||(s[10]=C(" Nouvel utilisateur ",-1))])])])])]),e("div",ye,[e("div",Me,[e("div",xe,[e("div",Ce,[e("div",Ue,[m(p(P),{class:"stat-icon"})]),e("div",Ae,[e("dl",null,[s[11]||(s[11]=e("dt",{class:"stat-label"},"Total utilisateurs",-1)),e("dd",Ve,r(u.value.length),1),s[12]||(s[12]=e("dd",{class:"stat-unit"},"utilisateurs",-1))])])])]),e("div",$e,[e("div",Se,[e("div",Le,[m(p(Y),{class:"stat-icon"})]),e("div",Pe,[e("dl",null,[s[13]||(s[13]=e("dt",{class:"stat-label"},"Utilisateurs actifs",-1)),e("dd",qe,r(j.value),1),s[14]||(s[14]=e("dd",{class:"stat-unit"},"actifs",-1))])])])]),e("div",Ne,[e("div",je,[e("div",Be,[m(p(ee),{class:"stat-icon"})]),e("div",Ee,[e("dl",null,[s[15]||(s[15]=e("dt",{class:"stat-label"},"Administrateurs",-1)),e("dd",Ie,r(O("admin")),1),s[16]||(s[16]=e("dd",{class:"stat-unit"},"admins",-1))])])])])]),e("div",Oe,[(i(!0),d(G,null,H(u.value,t=>(i(),d("div",{key:t.id,class:"user-card"},[e("div",Te,[e("div",De,[e("div",Re,r(t.first_name.charAt(0))+r(t.last_name.charAt(0)),1)]),e("div",Ze,[e("h3",ze,r(t.first_name)+" "+r(t.last_name),1),e("p",Fe,r(t.email),1)])]),e("div",Ge,[e("span",{class:V(`role-badge role-${t.role}`)},r(I(t.role)),3),e("span",{class:V(`status-badge status-${t.actif?"active":"inactive"}`)},r(t.actif?"Actif":"Inactif"),3)]),t.phone?(i(),d("div",He,[m(p(te),{class:"phone-icon"}),C(" "+r(t.phone),1)])):k("",!0),e("div",Je,[e("button",{onClick:D=>S(t),class:"action-button action-secondary"},[m(p(X),{class:"h-4 w-4 mr-2"}),s[17]||(s[17]=C(" Modifier ",-1))],8,Ke),e("button",{onClick:D=>E(t.id),class:"action-button action-danger"},[m(p(se),{class:"h-4 w-4 mr-2"}),s[18]||(s[18]=C(" Supprimer ",-1))],8,Qe)])]))),128))])]),c.value?(i(),d("div",{key:0,class:"modal-overlay",onClick:b},[e("div",{class:"modal-content",onClick:s[8]||(s[8]=$(()=>{},["stop"]))},[e("div",We,[e("h2",Xe,r(a.value?"Modifier l'utilisateur":"Nouvel utilisateur"),1),e("button",{onClick:b,class:"modal-close"},[...s[19]||(s[19]=[e("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$(B,["prevent"]),class:"modal-form"},[e("div",Ye,[e("div",es,[s[20]||(s[20]=e("label",{class:"form-label"},"Prénom *",-1)),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.value.first_name=t),type:"text",required:"",class:"form-input",placeholder:"Prénom"},null,512),[[h,n.value.first_name]])]),e("div",ss,[s[21]||(s[21]=e("label",{class:"form-label"},"Nom *",-1)),v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.value.last_name=t),type:"text",required:"",class:"form-input",placeholder:"Nom"},null,512),[[h,n.value.last_name]])])]),e("div",ts,[s[22]||(s[22]=e("label",{class:"form-label"},"Email *",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.value.email=t),type:"email",required:"",class:"form-input",placeholder:"email@exemple.com"},null,512),[[h,n.value.email]])]),a.value?k("",!0):(i(),d("div",os,[s[23]||(s[23]=e("label",{class:"form-label"},"Mot de passe *",-1)),v(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.value.password=t),type:"password",required:"",class:"form-input",placeholder:"Mot de passe"},null,512),[[h,n.value.password]])])),e("div",as,[e("div",ls,[s[25]||(s[25]=e("label",{class:"form-label"},"Rôle *",-1)),v(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>n.value.role=t),required:"",class:"form-select"},[...s[24]||(s[24]=[K('<option value="operator" data-v-82d53fef>Opérateur</option><option value="manager" data-v-82d53fef>Manager</option><option value="admin" data-v-82d53fef>Administrateur</option><option value="secretaire" data-v-82d53fef>Secrétaire</option><option value="livreur" data-v-82d53fef>Livreur</option>',5)])],512),[[J,n.value.role]])]),e("div",ns,[s[26]||(s[26]=e("label",{class:"form-label"},"Téléphone",-1)),v(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>n.value.phone=t),type:"tel",class:"form-input",placeholder:"+33 6 12 34 56 78"},null,512),[[h,n.value.phone]])])]),e("div",rs,[s[28]||(s[28]=e("label",{class:"form-label"},"Statut",-1)),e("div",is,[e("label",ds,[v(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>n.value.actif=t),type:"checkbox",class:"checkbox-input"},null,512),[[Q,n.value.actif]]),s[27]||(s[27]=e("span",{class:"checkbox-text"},"Utilisateur actif",-1))])])]),e("div",us,[e("button",{type:"button",onClick:b,class:"btn btn-secondary"}," Annuler "),e("button",cs,r(a.value?"Mettre à jour":"Créer"),1)])],32)])])):k("",!0),g.value&&l.value?(i(),F(ve,{key:1,show:g.value,user:l.value,onClose:L,onSuccess:T},null,8,["show","user"])):k("",!0)]))}}),hs=N(ms,[["__scopeId","data-v-82d53fef"]]);export{hs as default};
