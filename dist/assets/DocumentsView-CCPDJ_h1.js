import{c as i,e,o as a,d as oe,u as re,a as d,l as f,A as ne,h as w,s as c,f as l,H as y,j as A,t as n,F as U,i as k,v as ae,m as T,p as le,I as ie,J as ce,K as F,L as M,n as E,N as de,D as ue,Z as me,O as N,_ as pe}from"./main-Ddag5VAa.js";import{r as H}from"./ArrowDownTrayIcon-B8lvhPgj.js";import{r as ge}from"./DocumentArrowDownIcon-4cdJvVAG.js";import{r as ve}from"./MagnifyingGlassIcon-B4tlMqpf.js";function xe($,D){return a(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function he($,D){return a(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0 0 21 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 0 0-1.913-.247M6.34 18H5.25A2.25 2.25 0 0 1 3 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 0 1 1.913-.247m10.5 0a48.536 48.536 0 0 0-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5Zm-3 0h.008v.008H15V10.5Z"})])}const fe={class:"documents-container min-h-screen bg-gray-50"},we={class:"header-content bg-white border-b border-gray-200 shadow-sm"},ye={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},_e={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},be={class:"flex items-center mb-4 sm:mb-0"},ke={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 flex items-center justify-center shadow-lg mr-4"},De={class:"flex space-x-3"},Ce=["disabled"],Le={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ve={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},Ae={class:"stat-card bg-white rounded-xl shadow-lg overflow-hidden"},Te={class:"stat-content p-6"},$e={class:"flex items-center"},je={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center shadow-lg"},Be={class:"ml-4"},Re={class:"stat-value text-2xl font-bold text-gray-900"},Ue={class:"stat-card bg-white rounded-xl shadow-lg overflow-hidden"},Fe={class:"stat-content p-6"},Me={class:"flex items-center"},Ee={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-green-500 to-green-600 flex items-center justify-center shadow-lg"},Ne={class:"ml-4"},He={class:"stat-value text-2xl font-bold text-gray-900"},Oe={class:"stat-card bg-white rounded-xl shadow-lg overflow-hidden"},Se={class:"stat-content p-6"},Ie={class:"flex items-center"},ze={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 flex items-center justify-center shadow-lg"},Ze={class:"ml-4"},Pe={class:"stat-value text-2xl font-bold text-gray-900"},qe={key:0,class:"bg-white rounded-xl shadow-lg p-6 mb-6"},Je={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ke={class:"relative"},We={class:"bg-white rounded-xl shadow-lg overflow-hidden"},Xe={class:"px-6 py-4 border-b border-gray-200"},Ye={class:"text-lg font-semibold text-gray-900"},Ge={class:"overflow-x-auto"},Qe={class:"min-w-full divide-y divide-gray-200"},et={class:"bg-white divide-y divide-gray-200"},tt={class:"px-6 py-4 whitespace-nowrap"},st={class:"flex items-center"},ot={class:"h-10 w-10 rounded-full bg-gradient-to-r from-orange-500 to-orange-600 flex items-center justify-center shadow-lg mr-4"},rt={class:"text-sm font-medium text-gray-900"},nt={class:"px-6 py-4 whitespace-nowrap"},at={class:"text-sm text-gray-900"},lt={class:"text-sm text-gray-500"},it={class:"px-6 py-4 whitespace-nowrap"},ct={class:"text-sm text-gray-900"},dt={key:0,class:"text-xs text-gray-500"},ut={class:"px-6 py-4 whitespace-nowrap"},mt={key:0,class:"text-sm font-bold text-green-600"},pt={key:1,class:"text-sm text-gray-400"},gt={class:"px-6 py-4 whitespace-nowrap"},vt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},xt={class:"flex space-x-2"},ht=["onClick"],ft=["onClick"],wt=["onClick"],yt={key:0,class:"text-center py-12"},_t={class:"text-gray-600"},bt={key:1,class:"text-center py-12"},kt={key:0,class:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4"},Dt={class:"bg-white rounded-lg shadow-xl w-full max-w-5xl h-full max-h-[90vh] flex flex-col"},Ct={class:"flex items-center justify-between p-4 border-b"},Lt={class:"text-lg font-semibold text-gray-900"},Vt={class:"flex-1 overflow-hidden"},At=["src"],Tt=oe({__name:"DocumentsView",setup($){const{getDocuments:D,downloadDocument:O,getDocument:$t}=re(),g=d([]),_=d(!1),u=d(""),x=d("all"),b=d("all"),h=d("all"),C=d(!1),j=d(null),B=d(!1),L=d(null),V=f(()=>{let s=g.value;if(u.value&&(s=s.filter(t=>t.numero?.toLowerCase().includes(u.value.toLowerCase())||t.titre?.toLowerCase().includes(u.value.toLowerCase())||t.numero_bl?.toLowerCase().includes(u.value.toLowerCase())||t.client?.nom?.toLowerCase().includes(u.value.toLowerCase())||t.client?.email?.toLowerCase().includes(u.value.toLowerCase()))),b.value!=="all"&&(s=s.filter(t=>t.type===b.value)),x.value!=="all"&&(s=s.filter(t=>t.statut===x.value)),h.value!=="all"){const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate());s=s.filter(r=>{const p=new Date(r.date||r.date_creation||r.created_at);switch(h.value){case"today":return p>=o;case"week":const v=new Date(o.getTime()-10080*60*1e3);return p>=v;case"month":const m=new Date(o.getTime()-720*60*60*1e3);return p>=m;default:return!0}})}return s.sort((t,o)=>{const r=new Date(t.date||t.date_creation||t.created_at).getTime();return new Date(o.date||o.date_creation||o.created_at).getTime()-r})}),S=f(()=>g.value.length),I=f(()=>g.value.filter(s=>s.type==="delivery_note"||s.type==="bon_livraison"||s.type==="bl").length),z=f(()=>g.value.filter(s=>s.type==="invoice"||s.type==="facture").length);f(()=>g.value.filter(s=>s.type!=="delivery_note"&&s.type!=="bon_livraison"&&s.type!=="bl"&&s.type!=="invoice"&&s.type!=="facture").length),ne(async()=>{await R()});const R=async()=>{try{_.value=!0;const s=await D();g.value=s.map(t=>({...t,numero_bl:t.numero||t.titre,date:t.date_creation||t.created_at,statut:t.statut||"actif",type:t.type||"document",client:Z(t),montant_total:P(t),file_url:t.file_url||(t.chemin_fichier?`storage/${t.chemin_fichier}`:null)})),console.log("‚úÖ [DocumentsView] Documents charg√©s:",g.value.length)}catch(s){console.error("‚ùå [DocumentsView] Erreur lors du chargement des documents:",s),alert("Erreur lors du chargement des documents")}finally{_.value=!1}},Z=s=>{if(s.donnees_document?.client_nom)return{nom:s.donnees_document.client_nom,email:s.donnees_document.telephone_client||"",adresse:s.donnees_document.adresse_livraison||""};const t=s.titre.match(/-\s*(.+)$/);return t?{nom:t[1],email:"",adresse:""}:{nom:"N/A",email:"",adresse:""}},P=s=>s.donnees_document?.items?s.donnees_document.items.reduce((t,o)=>t+(o.quantite||0)*(o.prix_unitaire||0),0):0,q=async s=>{try{console.log("üìÑ [DocumentsView] Ouverture du document:",s.id);const t=N(),o=`${t.getBaseURL()}/documents/${s.id}/download`,r=await fetch(o,{headers:t.getHeaders()});if(r.ok){const p=await r.blob(),v=window.URL.createObjectURL(p);window.open(v,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(v),1e3)}else throw new Error("Erreur lors du chargement du document")}catch(t){console.error("‚ùå [DocumentsView] Erreur lors de l'ouverture du document:",t),alert("Erreur lors de l'ouverture du document. V√©rifiez que le document existe.")}},J=async s=>{try{console.log("üì• [DocumentsView] T√©l√©chargement du document:",s.id),await O(s.id),console.log("‚úÖ [DocumentsView] Document t√©l√©charg√© avec succ√®s")}catch(t){console.error("‚ùå [DocumentsView] Erreur lors du t√©l√©chargement:",t),alert("Erreur lors du t√©l√©chargement du document")}},K=async s=>{try{console.log("üñ®Ô∏è [DocumentsView] Impression du document:",s.id);const t=N(),o=`${t.getBaseURL()}/documents/${s.id}/download`,r=await fetch(o,{headers:t.getHeaders()});if(r.ok){const p=await r.blob(),v=window.URL.createObjectURL(p),m=s.createElement("iframe");m.style.display="none",m.src=v,m.onload=()=>{setTimeout(()=>{m.contentWindow?.print(),setTimeout(()=>{m.parentNode&&s.body.removeChild(m),window.URL.revokeObjectURL(v)},1e3)},500)},s.body.appendChild(m)}else throw new Error("Erreur lors du chargement du document")}catch(t){console.error("‚ùå [DocumentsView] Erreur lors de l'impression:",t),alert("Erreur lors de l'impression du document")}},W=()=>{B.value=!1,j.value=null,L.value=null},X=async()=>{await R()},Y=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}catch{return s}},G=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF"}).format(s),Q=s=>{switch(s){case"actif":case"active":return"bg-green-100 text-green-800";case"archive":case"archived":return"bg-gray-100 text-gray-800";case"delete":case"deleted":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},ee=s=>{switch(s){case"delivery_note":case"bon_livraison":case"bl":return"bg-blue-100 text-blue-800";case"invoice":case"facture":return"bg-green-100 text-green-800";case"receipt":case"re√ßu":return"bg-purple-100 text-purple-800";case"report":case"rapport":return"bg-orange-100 text-orange-800";case"commande":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},te=s=>{switch(s){case"delivery_note":case"bon_livraison":case"bl":return"Bon de Livraison";case"invoice":case"facture":return"Facture";case"receipt":case"re√ßu":return"Re√ßu";case"report":case"rapport":return"Rapport";case"commande":return"Commande";default:return s||"Document"}},se=s=>{switch(s){case"delivery_note":case"bon_livraison":case"bl":return U;case"invoice":case"facture":return y;default:return y}};return(s,t)=>(a(),i("div",fe,[e("div",we,[e("div",ye,[e("div",_e,[e("div",be,[e("div",ke,[c(l(y),{class:"h-6 w-6 text-white"})]),t[5]||(t[5]=e("div",null,[e("h1",{class:"page-title text-2xl font-bold text-gray-900"},"Documents"),e("p",{class:"text-sm text-gray-600"},"Bons de livraison et documents g√©n√©r√©s")],-1))]),e("div",De,[e("button",{onClick:t[0]||(t[0]=o=>C.value=!C.value),class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-all duration-200"},[c(l(xe),{class:"h-5 w-5 mr-2"}),t[6]||(t[6]=A(" Filtres ",-1))]),e("button",{onClick:X,disabled:_.value,class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-xl shadow-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50"},[c(l(H),{class:"h-5 w-5 mr-2"}),t[7]||(t[7]=A(" Actualiser ",-1))],8,Ce)])])])]),e("div",Le,[e("div",Ve,[e("div",Ae,[e("div",Te,[e("div",$e,[e("div",je,[c(l(y),{class:"h-6 w-6 text-white"})]),e("div",Be,[t[8]||(t[8]=e("p",{class:"text-sm font-medium text-gray-600"},"Total documents",-1)),e("p",Re,n(S.value),1)])])])]),e("div",Ue,[e("div",Fe,[e("div",Me,[e("div",Ee,[c(l(U),{class:"h-6 w-6 text-white"})]),e("div",Ne,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Bons de livraison",-1)),e("p",He,n(I.value),1)])])])]),e("div",Oe,[e("div",Se,[e("div",Ie,[e("div",ze,[c(l(ge),{class:"h-6 w-6 text-white"})]),e("div",Ze,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Factures",-1)),e("p",Pe,n(z.value),1)])])])])]),C.value?(a(),i("div",qe,[e("div",Je,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rechercher",-1)),e("div",Ke,[c(l(ve),{class:"h-5 w-5 absolute left-3 top-3 text-gray-400"}),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o),type:"text",placeholder:"Num√©ro BL, client...",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[ae,u.value]])])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type",-1)),k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>b.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},[...t[12]||(t[12]=[le('<option value="all" data-v-22eb461b>Tous les types</option><option value="delivery_note" data-v-22eb461b>Bon de Livraison</option><option value="invoice" data-v-22eb461b>Facture</option><option value="receipt" data-v-22eb461b>Re√ßu</option><option value="report" data-v-22eb461b>Rapport</option>',5)])],512),[[T,b.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),k(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>x.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},[...t[14]||(t[14]=[e("option",{value:"all"},"Tous les statuts",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"archived"},"Archiv√©",-1)])],512),[[T,x.value]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"P√©riode",-1)),k(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>h.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},[...t[16]||(t[16]=[e("option",{value:"all"},"Toutes les p√©riodes",-1),e("option",{value:"today"},"Aujourd'hui",-1),e("option",{value:"week"},"Cette semaine",-1),e("option",{value:"month"},"Ce mois",-1)])],512),[[T,h.value]])])])])):w("",!0),e("div",We,[e("div",Xe,[e("h2",Ye," Documents ("+n(V.value.length)+") ",1)]),e("div",Ge,[e("table",Qe,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Document"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Montant"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Statut"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",et,[(a(!0),i(ie,null,ce(V.value,o=>(a(),i("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",tt,[e("div",st,[e("div",ot,[(a(),F(M(se(o.type)),{class:"h-5 w-5 text-white"}))]),e("div",null,[e("div",rt,n(o.numero||o.numero_bl||o.titre),1),e("span",{class:E(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1",ee(o.type)])},n(te(o.type)),3)])])]),e("td",nt,[e("div",at,n(o.client?.nom||"N/A"),1),e("div",lt,n(o.client?.email||""),1)]),e("td",it,[e("div",ct,n(Y(o.date||o.date_creation||o.created_at)),1),o.createur?(a(),i("div",dt," Par: "+n(o.createur?.name||"N/A"),1)):w("",!0)]),e("td",ut,[o.montant_total>0?(a(),i("div",mt,n(G(o.montant_total)),1)):(a(),i("div",pt,"-"))]),e("td",gt,[e("span",{class:E(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",Q(o.statut)])},[(a(),F(M(o.statut==="active"||o.statut==="actif"?l(de):l(ue)),{class:"h-3 w-3 mr-1"})),A(" "+n(o.statut==="active"?"Actif":o.statut==="archived"?"Archiv√©":o.statut==="deleted"?"Supprim√©":o.statut||"N/A"),1)],2)]),e("td",vt,[e("div",xt,[e("button",{onClick:r=>q(o),class:"text-orange-600 hover:text-orange-900 transition-colors",title:"Voir"},[c(l(me),{class:"h-4 w-4"})],8,ht),e("button",{onClick:r=>J(o),class:"text-blue-600 hover:text-blue-900 transition-colors",title:"T√©l√©charger"},[c(l(H),{class:"h-4 w-4"})],8,ft),e("button",{onClick:r=>K(o),class:"text-green-600 hover:text-green-900 transition-colors",title:"Imprimer"},[c(l(he),{class:"h-4 w-4"})],8,wt)])])]))),128))])])]),V.value.length===0?(a(),i("div",yt,[c(l(y),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t[19]||(t[19]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucun document trouv√©",-1)),e("p",_t,n(u.value||x.value!=="all"||h.value!=="all"?"Aucun document ne correspond aux crit√®res de recherche.":"Commencez par g√©n√©rer vos premiers documents."),1)])):w("",!0),_.value?(a(),i("div",bt,[...t[20]||(t[20]=[e("div",{class:"inline-flex items-center"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),e("span",{class:"ml-3 text-gray-600"},"Chargement des documents...")],-1)])])):w("",!0)])]),B.value&&L.value?(a(),i("div",kt,[e("div",Dt,[e("div",Ct,[e("h3",Lt,n(j.value?.titre||"Document"),1),e("button",{onClick:W,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[21]||(t[21]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Vt,[e("iframe",{src:L.value,class:"w-full h-full border-0",title:"Visualisation du document"},null,8,At)])])])):w("",!0)]))}}),Ft=pe(Tt,[["__scopeId","data-v-22eb461b"]]);export{Ft as default};
