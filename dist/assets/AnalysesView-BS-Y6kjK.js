import{c as n,e as t,o as l,d as z,u as H,a as g,l as K,A as W,s as i,f as c,B as q,j as y,i as V,m as F,D as X,h as w,n as P,G as $,F as M,t as s,y as Y,I as S,J as L,_ as Z}from"./main-C7B5hG3I.js";import{r as tt}from"./DocumentArrowDownIcon-B7lDIpdn.js";import{r as et}from"./UserGroupIcon-BNTbmO21.js";function st(N,D){return l(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"})])}const ot={class:"analyses-container min-h-screen bg-gray-50"},at={class:"header-content bg-white border-b border-gray-200 shadow-sm"},rt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},nt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},lt={class:"flex items-center mb-4 sm:mb-0"},it={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 flex items-center justify-center shadow-lg mr-4"},dt={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"},ct=["disabled"],ut=["disabled"],xt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},gt={class:"bg-white rounded-xl shadow-lg p-6 mb-6"},mt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0"},pt={class:"flex items-center space-x-4"},vt={class:"flex items-center space-x-4"},yt=["disabled"],ft={class:"bg-white rounded-xl shadow-lg overflow-hidden mb-6"},_t={class:"border-b border-gray-200"},bt={class:"flex"},ht={key:0,class:"p-6"},wt={class:"text-lg font-semibold text-gray-900 mb-6"},kt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},jt={class:"stat-card bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},Ct={class:"stat-content p-6"},Pt={class:"flex items-center"},St={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 flex items-center justify-center shadow-lg"},Lt={class:"ml-4"},Dt={class:"stat-value text-2xl font-bold text-gray-900"},Et={class:"text-xs text-gray-500"},At={class:"stat-card bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},Tt={class:"stat-content p-6"},Rt={class:"flex items-center"},qt={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-green-500 to-green-600 flex items-center justify-center shadow-lg"},Vt={class:"ml-4"},Ft={class:"stat-value text-2xl font-bold text-gray-900"},$t={class:"text-xs text-gray-500"},Mt={class:"stat-card bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},Nt={class:"stat-content p-6"},Bt={class:"flex items-center"},Ut={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 flex items-center justify-center shadow-lg"},Gt={class:"ml-4"},It={class:"stat-value text-2xl font-bold text-gray-900"},Jt={class:"text-xs text-gray-500"},Ot={class:"stat-card bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},Qt={class:"stat-content p-6"},zt={class:"flex items-center"},Ht={class:"h-12 w-12 rounded-xl bg-gradient-to-r from-red-500 to-red-600 flex items-center justify-center shadow-lg"},Kt={class:"ml-4"},Wt={class:"stat-value text-2xl font-bold text-gray-900"},Xt={key:1,class:"p-6"},Yt={class:"text-lg font-semibold text-gray-900 mb-6"},Zt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},te={class:"bg-white border border-gray-200 rounded-xl shadow-lg p-6"},ee={class:"space-y-4"},se={class:"flex justify-between items-center"},oe={class:"font-bold text-lg"},ae={class:"flex justify-between items-center"},re={class:"font-bold text-lg text-green-600"},ne={class:"flex justify-between items-center"},le={class:"font-bold text-lg text-orange-600"},ie={class:"flex justify-between items-center"},de={class:"font-bold text-lg"},ce={class:"flex justify-between items-center"},ue={class:"font-bold text-lg"},xe={class:"bg-white border border-gray-200 rounded-xl shadow-lg p-6"},ge={class:"space-y-4"},me={class:"flex justify-between items-center"},pe={class:"font-bold"},ve={class:"flex justify-between items-center"},ye={class:"font-bold"},fe={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},_e={class:"overflow-x-auto"},be={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Pe={key:2,class:"p-6"},Se={class:"text-lg font-semibold text-gray-900 mb-6"},Le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},De={class:"bg-white border border-gray-200 rounded-xl shadow-lg p-6"},Ee={class:"space-y-4"},Ae={class:"flex justify-between items-center"},Te={class:"font-bold text-lg"},Re={class:"flex justify-between items-center"},qe={class:"font-bold text-lg text-green-600"},Ve={class:"flex justify-between items-center"},Fe={class:"font-bold text-lg text-orange-600"},$e={class:"flex justify-between items-center"},Me={class:"font-bold text-lg"},Ne={class:"bg-white border border-gray-200 rounded-xl shadow-lg p-6"},Be={class:"space-y-3"},Ue={class:"text-sm text-gray-600"},Ge={class:"font-bold text-sm"},Ie={key:0,class:"bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"},Je={class:"overflow-x-auto"},Oe={class:"min-w-full divide-y divide-gray-200"},Qe={class:"bg-white divide-y divide-gray-200"},ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},We=z({__name:"AnalysesView",setup(N){const{getGeneralStats:D,getProductionStats:B,getDeliveryStats:U,generatePdfReport:G,sendEmailReport:I}=H(),u=g(!1),x=g("overview"),m=g("month"),f=g(""),_=g(""),j=g("production"),b=g({}),d=g({}),p=g({}),v=K(()=>{switch(m.value){case"day":return"Aujourd'hui";case"week":return"Cette semaine";case"month":return"Ce mois";case"year":return"Cette année";default:return"Période personnalisée"}});W(async()=>{await E(),await A(),await T()});const E=async()=>{try{u.value=!0,b.value=await D()}catch(o){console.error("Erreur lors du chargement des statistiques générales:",o)}finally{u.value=!1}},A=async()=>{try{const o={period:m.value};f.value&&_.value&&(o.start_date=f.value,o.end_date=_.value),d.value=await B(o)}catch(o){console.error("Erreur lors du chargement des statistiques de production:",o)}},T=async()=>{try{const o={period:m.value};f.value&&_.value&&(o.start_date=f.value,o.end_date=_.value),p.value=await U(o)}catch(o){console.error("Erreur lors du chargement des statistiques de livraison:",o)}},R=async()=>{await Promise.all([E(),A(),T()])},J=async()=>{try{u.value=!0;const o={type:j.value,period:m.value,start_date:f.value,end_date:_.value},e=await G(o);if(e.success){console.log("Données du rapport:",e.data);const C=JSON.stringify(e.data,null,2),a=new Blob([C],{type:"application/json"}),k=URL.createObjectURL(a),h=document.createElement("a");h.href=k,h.download=e.filename,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(k),alert("Rapport généré et téléchargé (format JSON temporaire) !")}else alert("Erreur lors de la génération du rapport: "+e.error)}catch(o){console.error("Erreur lors de la génération du PDF:",o),alert("Erreur lors de la génération du PDF")}finally{u.value=!1}},O=async()=>{try{u.value=!0;const o={type:m.value==="week"?"weekly":"monthly",email:"clemsobonding@gmail.com",period:m.value};(await I(o)).success&&alert("Rapport envoyé par email avec succès !")}catch(o){console.error("Erreur lors de l'envoi de l'email:",o),alert("Erreur lors de l'envoi de l'email")}finally{u.value=!1}},Q=()=>{R()},r=o=>new Intl.NumberFormat("fr-FR").format(o);return(o,e)=>{const C=Y("ExclamationTriangleIcon");return l(),n("div",ot,[t("div",at,[t("div",rt,[t("div",nt,[t("div",lt,[t("div",it,[i(c(q),{class:"h-6 w-6 text-white"})]),e[5]||(e[5]=t("div",null,[t("h1",{class:"page-title text-2xl font-bold text-gray-900"},"Analyses & Rapports"),t("p",{class:"text-sm text-gray-600"},"Tableaux de bord et analyses détaillées")],-1))]),t("div",dt,[t("button",{onClick:J,disabled:u.value,class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white font-medium rounded-xl shadow-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50"},[i(c(tt),{class:"h-5 w-5 mr-2"}),e[6]||(e[6]=y(" PDF ",-1))],8,ct),t("button",{onClick:O,disabled:u.value,class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white font-medium rounded-xl shadow-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50"},[i(c(st),{class:"h-5 w-5 mr-2"}),e[7]||(e[7]=y(" Email ",-1))],8,ut)])])])]),t("div",xt,[t("div",gt,[t("div",mt,[t("div",pt,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-gray-700"},"Période:",-1)),V(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),onChange:Q,class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},[...e[8]||(e[8]=[t("option",{value:"day"},"Aujourd'hui",-1),t("option",{value:"week"},"Cette semaine",-1),t("option",{value:"month"},"Ce mois",-1),t("option",{value:"year"},"Cette année",-1)])],544),[[F,m.value]])]),t("div",vt,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-gray-700"},"Type de rapport:",-1)),V(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>j.value=a),class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},[...e[10]||(e[10]=[t("option",{value:"production"},"Production",-1),t("option",{value:"delivery"},"Livraison",-1),t("option",{value:"general"},"Général",-1)])],512),[[F,j.value]])]),t("button",{onClick:R,disabled:u.value,class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 disabled:opacity-50"},[i(c(X),{class:"h-4 w-4 mr-2"}),e[12]||(e[12]=y(" Actualiser ",-1))],8,yt)])]),t("div",ft,[t("div",_t,[t("nav",bt,[t("button",{onClick:e[2]||(e[2]=a=>x.value="overview"),class:P(["flex-1 px-6 py-4 text-sm font-medium text-center transition-all duration-200",x.value==="overview"?"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-b-2 border-blue-500":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"])},[i(c(q),{class:"h-5 w-5 mx-auto mb-2"}),e[13]||(e[13]=y(" Vue d'ensemble ",-1))],2),t("button",{onClick:e[3]||(e[3]=a=>x.value="production"),class:P(["flex-1 px-6 py-4 text-sm font-medium text-center transition-all duration-200",x.value==="production"?"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-b-2 border-blue-500":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"])},[i(c($),{class:"h-5 w-5 mx-auto mb-2"}),e[14]||(e[14]=y(" Production ",-1))],2),t("button",{onClick:e[4]||(e[4]=a=>x.value="delivery"),class:P(["flex-1 px-6 py-4 text-sm font-medium text-center transition-all duration-200",x.value==="delivery"?"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-b-2 border-blue-500":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"])},[i(c(M),{class:"h-5 w-5 mx-auto mb-2"}),e[15]||(e[15]=y(" Livraison ",-1))],2)])]),x.value==="overview"?(l(),n("div",ht,[t("h2",wt,"Statistiques Générales - "+s(v.value),1),t("div",kt,[t("div",jt,[t("div",Ct,[t("div",Pt,[t("div",St,[i(c($),{class:"h-6 w-6 text-white"})]),t("div",Lt,[e[16]||(e[16]=t("p",{class:"text-sm font-medium text-gray-600"},"Productions",-1)),t("p",Dt,s(r(b.value.productions?.total||0)),1),t("p",Et,s(v.value),1)])])])]),t("div",At,[t("div",Tt,[t("div",Rt,[t("div",qt,[i(c(M),{class:"h-6 w-6 text-white"})]),t("div",Vt,[e[17]||(e[17]=t("p",{class:"text-sm font-medium text-gray-600"},"Livraisons",-1)),t("p",Ft,s(r(b.value.livraisons?.total||0)),1),t("p",$t,s(v.value),1)])])])]),t("div",Mt,[t("div",Nt,[t("div",Bt,[t("div",Ut,[i(c(et),{class:"h-6 w-6 text-white"})]),t("div",Gt,[e[18]||(e[18]=t("p",{class:"text-sm font-medium text-gray-600"},"Commandes",-1)),t("p",It,s(r(b.value.commandes?.total||0)),1),t("p",Jt,s(v.value),1)])])])]),t("div",Ot,[t("div",Qt,[t("div",zt,[t("div",Ht,[i(C,{class:"h-6 w-6 text-white"})]),t("div",Kt,[e[19]||(e[19]=t("p",{class:"text-sm font-medium text-gray-600"},"Stock Critique",-1)),t("p",Wt,s(r(b.value.articles?.stock_critique||0)),1),e[20]||(e[20]=t("p",{class:"text-xs text-gray-500"},"articles",-1))])])])])])])):w("",!0),x.value==="production"?(l(),n("div",Xt,[t("h2",Yt,"Analyse de Production - "+s(v.value),1),t("div",Zt,[t("div",te,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Statistiques",-1)),t("div",ee,[t("div",se,[e[21]||(e[21]=t("span",{class:"text-gray-600"},"Total Productions",-1)),t("span",oe,s(r(d.value.total_productions||0)),1)]),t("div",ae,[e[22]||(e[22]=t("span",{class:"text-gray-600"},"Terminées",-1)),t("span",re,s(r(d.value.productions_terminees||0)),1)]),t("div",ne,[e[23]||(e[23]=t("span",{class:"text-gray-600"},"En cours",-1)),t("span",le,s(r(d.value.productions_en_cours||0)),1)]),t("div",ie,[e[24]||(e[24]=t("span",{class:"text-gray-600"},"Ciment utilisé",-1)),t("span",de,s(r(d.value.total_ciment_utilise||0))+" kg",1)]),t("div",ce,[e[25]||(e[25]=t("span",{class:"text-gray-600"},"Adjuvant utilisé",-1)),t("span",ue,s(r(d.value.total_adjuvant_utilise||0))+" kg",1)])])]),t("div",xe,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Matériaux",-1)),t("div",ge,[t("div",me,[e[27]||(e[27]=t("span",{class:"text-gray-600"},"Moyenne ciment/production",-1)),t("span",pe,s(Math.round(d.value.materiaux_utilises?.moyenne_ciment_par_production||0))+" kg",1)]),t("div",ve,[e[28]||(e[28]=t("span",{class:"text-gray-600"},"Moyenne adjuvant/production",-1)),t("span",ye,s(Math.round(d.value.materiaux_utilises?.moyenne_adjuvant_par_production||0))+" kg",1)])])])]),d.value.productions_par_jour?.length>0?(l(),n("div",fe,[e[31]||(e[31]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Productions par Jour")],-1)),t("div",_e,[t("table",be,[e[30]||(e[30]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Productions"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ciment (kg)"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Adjuvant (kg)")])],-1)),t("tbody",he,[(l(!0),n(S,null,L(d.value.productions_par_jour,a=>(l(),n("tr",{key:a.date},[t("td",we,s(new Date(a.date).toLocaleDateString("fr-FR")),1),t("td",ke,s(a.count),1),t("td",je,s(a.ciment_total||0),1),t("td",Ce,s(a.adjuvant_total||0),1)]))),128))])])])])):w("",!0)])):w("",!0),x.value==="delivery"?(l(),n("div",Pe,[t("h2",Se,"Analyse de Livraison - "+s(v.value),1),t("div",Le,[t("div",De,[e[36]||(e[36]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Statistiques",-1)),t("div",Ee,[t("div",Ae,[e[32]||(e[32]=t("span",{class:"text-gray-600"},"Total Livraisons",-1)),t("span",Te,s(r(p.value.total_livraisons||0)),1)]),t("div",Re,[e[33]||(e[33]=t("span",{class:"text-gray-600"},"Terminées",-1)),t("span",qe,s(r(p.value.livraisons_terminees||0)),1)]),t("div",Ve,[e[34]||(e[34]=t("span",{class:"text-gray-600"},"En cours",-1)),t("span",Fe,s(r(p.value.livraisons_en_cours||0)),1)]),t("div",$e,[e[35]||(e[35]=t("span",{class:"text-gray-600"},"Quantité livrée",-1)),t("span",Me,s(r(p.value.total_quantite_livree||0)),1)])])]),t("div",Ne,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Top Produits Livrés",-1)),t("div",Be,[(l(!0),n(S,null,L(p.value.top_produits_livres?.slice(0,5),(a,k)=>(l(),n("div",{key:a.nom,class:"flex justify-between items-center"},[t("span",Ue,s(k+1)+". "+s(a.nom),1),t("span",Ge,s(r(a.quantite_totale)),1)]))),128))])])]),p.value.livraisons_par_jour?.length>0?(l(),n("div",Ie,[e[39]||(e[39]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Livraisons par Jour")],-1)),t("div",Je,[t("table",Oe,[e[38]||(e[38]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Livraisons"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Quantité Totale")])],-1)),t("tbody",Qe,[(l(!0),n(S,null,L(p.value.livraisons_par_jour,a=>(l(),n("tr",{key:a.date},[t("td",ze,s(new Date(a.date).toLocaleDateString("fr-FR")),1),t("td",He,s(a.count),1),t("td",Ke,s(a.total_quantite||0),1)]))),128))])])])])):w("",!0)])):w("",!0)])])])}}}),ts=Z(We,[["__scopeId","data-v-0bfc220e"]]);export{ts as default};
